import{i as e,a as t,n,l as s,b as l,c as a,p as i,d as o}from"./options-553cfc67.js";import"./common-7dd0cba4.js";const r=(e,t)=>t?e.lastIndexOf("\n",t-1)+1:0,c=(e,t)=>(t=e.indexOf("\n",t))+1?t:e.length;let d;const p=e=>e.replace(/[$+?|.^*()[\]{}\\]/g,"\\$&"),h=(e,t)=>e.slice(r(e,t),t),u=(e,t,n=t)=>[e.slice(t=r(e,t),n=c(e,n)).split("\n"),t,n],g=(e,t,s=0,l=s,a=e.getSelection()[0])=>{const i=e.value,o=e.wrapper.children[n(i,0,a)],r=document.createTreeWalker(o,5);let d=r.lastChild(),p=c(i,a)+1-a-d.length;for(;-p<=l&&(d=r.previousNode());)if(!d.lastChild&&(p-=d.length||0,p<=s))for(;d!=o;d=d.parentNode)if(d.matches?.(t))return d},f=(e,t)=>g(e,'[class*="language-"]',0,0,t)?.className.match(/language-(\S*)/)[1]||e.options.language,m=(n,s,l,a,i,o)=>{if(n.options.readOnly)return;d=n.getSelection(),a??(a=l);let r,c=n.textarea,p=n.value,h=e&&!p[a??d[1]]&&/\n$/.test(s)&&/^$|\n$/.test(p);n.focused||c.focus(),null!=l&&c.setSelectionRange(l,a),null!=i&&(r=((e,t,n)=>(e.addListener(t,n),()=>e.removeListener(t,n)))(n,"update",(()=>{c.setSelectionRange(i,o??i,d[2]),r()}))),t||c.dispatchEvent(new InputEvent("beforeinput",{data:s})),e||t?(h&&(c.selectionEnd--,s=s.slice(0,-1)),t&&(s+="\n"),document.execCommand(s?"insertHTML":"delete",!1,s.replace(/&/g,"&amp;").replace(/</g,"&lt;")),h&&c.selectionStart++):document.execCommand(s?"insertText":"delete",!1,s),d=0},x=e=>e.altKey+2*e.ctrlKey+4*e.metaKey+8*e.shiftKey,y=/\[]|\(\)|{}/,v=/[([{][^)\]}]*$/,b=([e,t],n)=>y.test(n[e-1]+n[t]),k={line:"//",block:["/*","*/"]};s.clike=s.js=s.javascript=s.ts=s.typescript=s.java=s.cs=s.csharp=s.c=s.cpp=s.go=s.d=s.dart=s.flow=s.haxe=((e=k,t=v)=>({comments:e,autoIndent:[([e],n)=>t.test(h(n,e)),b]}))(k,/[([{][^)\]}]*$|^[^.]*\b(?:case .+?|default):\s*$/);const C=(e=!0,t="([{",n=")]}")=>{let s;const l=t=>{t.extensions.matchBrackets=l,t.addListener("tokenize",o),e&&t.tokens[0]?t.update():o(t.tokens)},a=l.brackets=[],i=l.pairs=[],o=t=>{if(i.length=a.length=s=0,r(t,0,0),e)for(let e,t=0;e=a[t];){let n=e[0].alias;e[0].alias=(n?n+" ":"")+"bracket-"+(null==i[t++]?"error":"level-"+e[2]%12)}},r=(e,l,o)=>{let c,d=[],p=0;for(let h=0;c=e[h++];){let e=c.length;if("string"!=typeof c){let h=c.content;if(Array.isArray(h))r(h,l,p+o);else if("punctuation"==(c.alias||c.type)){let r=$(h,t,e-1),u=r||$(h,n,e-1);if(u){if(a[s]=[c,l,0,h,!!r,l+e],r)d[p++]=[s,r];else for(let e=p;e;){let[t,n]=d[--e];u==n&&(i[i[s]=t]=s,a[s][2]=a[t][2]=e+o,p=e,e=0)}s++}}}l+=e}};return l},$=(e,t,n)=>t.indexOf(e[0])+1||n&&t.indexOf(e[n])+1,S=a("<div class=guide-indents style=left:var(--padding-left)><div style=position:relative;display:inline-block> "),w=a("<div style=width:1px;position:absolute;background:var(--bg-guide-indent)>"),L=()=>{let e,t,n,s=0,l=-1;const a=[],i=[],o=S(),r=o.lastChild,c=[],d=e=>{t=[];const n=h(e.split("\n")),l=n.length;for(let e=0,s=[],l=n[0];l;e++){const o=(a[e]||(a[e]=w())).style,[r,c,d]=l,p=i[e];l=n[e+1],r!=p?.[0]&&(o.top=r+"00%"),c!=p?.[1]&&(o.height=c+"00%"),d!=p?.[2]&&(o.left=100*d+"%");for(let n=-(s[0]!=r&&l?.[0]!=r),a=c+(s[0]+s[1]!=r+c&&l?.[0]+l?.[1]!=r+c);n<a;n++)t[n+r]=e;s=i[e]=n[e]}for(let e=s;e>l;)a[--e].remove();r.append(...a.slice(s,s=l))},p=()=>{const e=t[n.activeLineNumber-1]??-1;e!=l&&(l>-1&&(a[l].className=""),e>-1&&(a[e].className="active")),l=e},h=t=>{const n=t.length,s=[],l=[];for(let a=0,i=-1,o=0,r=0;;o++){const d=o==n,p=d?0:c[o]=u(t[o]);if(p<0)i<0&&(i=o);else{for(let e=p;e<a;e++)s[e][1]=(i<0||e==p&&!d?o:i)-s[e][0];for(let t=a;t<p;)l[r++]=s[t]=[i<0||t>a?o:i,0,t++*e];i=-1,a=p}if(d)break}return c.length=n,l},u=t=>{let n=t.search(/\S/),s=0;if(n<0)return n;for(let l=0;l<n;)s+="\t"==t[l++]?e-s%e:1;return Math.ceil(s/e)};return{lines:r.children,indentLevels:c,update(t,s){n||(n=t,t.extensions.indentGuides=this,t.overlays.append(o),t.addListener("update",d),t.addListener("selectionChange",p)),o.style.display=s.wordWrap?"none":"",e!=(e=s.tabSize||2)&&(d(t.value),p())}}},E=a("<div style=position:absolute;top:0;opacity:0;padding:inherit> <span></span> "),M=()=>{let t,n=" ",s=" ";const a=E(),[i,o,r]=a.childNodes,d=([e,l,o])=>{let{value:d,activeLine:p}=t,u="backward"==o?e:l,g=h(d,u),f=d.slice(u,c(d,u));g||f||(f=" "),n!=g&&(i.data=n=g),s!=f&&(r.data=s=f),a.parentNode!=p&&p.prepend(a)},p=()=>((t,n,s=0)=>{const l=t.scrollContainer.style,a=document.documentElement.style;l.scrollPaddingBlock=a.scrollPaddingBlock=`${s}px ${e&&!n.textContent?n.offsetHeight:0}px`,n.scrollIntoView({block:"nearest"}),l.scrollPaddingBlock=a.scrollPaddingBlock=""})(t,o),u=e=>{e.addListener("selectionChange",d),t=e,e.extensions.cursor=u,l(e,"input",(e=>{/history/.test(e.inputType)&&p()})),e.activeLine&&d(e.getSelection())};return u.getPosition=()=>{const e=o.getBoundingClientRect(),n=t.overlays.getBoundingClientRect();return{top:e.y-n.y,bottom:n.bottom-e.bottom,left:e.x-n.x,right:n.right-e.x,height:e.height}},u.scrollIntoView=p,u.element=o,u};let R=!1;const T=navigator.clipboard,j=o?4:2,I=e=>e.search(/\S|$/),N=(e=['""',"''","``","()","[]","{}"],t=/([^$\w'"`]["'`]|.[[({])[.,:;\])}>\s]|.[[({]`/s)=>(n,a)=>{let c;const{keyCommandMap:d,inputCommandMap:g,getSelection:y}=n,v=({insertSpaces:e=!0,tabSize:t})=>[e?" ":"\t",e?t||2:1],b=()=>!n.extensions.cursor?.scrollIntoView(),k=([e,s],[l,a],i,o)=>(e<s||!o&&t.test((i[s-1]||" ")+l+(i[s]||" ")))&&!m(n,l+i.slice(e,s)+a,null,null,e+1,s+1),C=([e,t],s,l)=>e==t&&l[t]==s&&!n.setSelection(e+1),$=(e,t,s,l,a,i)=>{let o=t.join("\n");if(o!=e.join("\n")){const r=e.length-1,c=t[r],d=e[r],p=d.length-c.length,h=t[0].length-e[0].length,u=s+I((h<0?t:e)[0]),g=l-d.length+I(p>0?c:d),f=s-l+o.length+p,x=u>a?a:Math.max(u,a+h),y=i+s-l+o.length;m(n,o,s,l,x,i<g?y+p:Math.max(g+f,y))}},S=(e,t,n,s,l,a,i,o)=>{$(t,t.map(e?e=>e.slice(I(e)?o-I(e)%o:0):e=>e&&i.repeat(o-I(e)%o)+e),n,s,l,a)};g["<"]=(e,t,n)=>k(t,"<>",n,!0),e.forEach((([e,t])=>{const n=e==t;g[e]=(s,l,a)=>(n&&C(l,t,a)||k(l,e+t,a))&&b(),n||(g[t]=(e,n,s)=>C(n,t,s)&&b())})),g[">"]=(e,t,l)=>{const a=s[f(n)]?.autoCloseTags?.(t,l,n);a&&(m(n,">"+a,null,null,t[0]+1),i(e))},d.Tab=(e,[t,s],l)=>{if(R||a.readOnly||6&x(e))return;const[i,o]=v(a),r=e.shiftKey,[c,d,p]=u(l,t,s);return t<s||r?S(r,c,d,p,t,s,i,o):m(n,i.repeat(o-(t-d)%o)),b()},d.Enter=(e,t,l)=>{const i=7&x(e);if(!i||i==j){i&&(t[0]=t[1]=u(l,t[1])[2]);const[e,o]=v(a),[r,c]=t,d=s[f(n)]?.autoIndent,p=Math.floor(I(h(l,r))/o)*o,g=d?.[0]?.(t,l,n)?o:0,x=d?.[1]?.(t,l,n),y="\n"+e.repeat(p+g)+(x?"\n"+e.repeat(p):"");if(y[1]||l[c])return m(n,y,r,c,r+p+g+1),b()}},d.Backspace=(t,[s,l],i)=>{if(s==l){const t=h(i,s),[,l]=v(a),o=e.includes(i.slice(s-1,s+1)),r=t.length%l||l;if(o||1!=r&&!/\S|^$/.test(t))return m(n,"",s-(o?1:r),s+ +o),b()}};for(let e=0;e<2;e++)d[e?"ArrowDown":"ArrowUp"]=(t,[s,l],a)=>{const i=x(t);if(1==(7&i)){if(1==i){const t=e?s:r(a,s)-1,i=e?a.indexOf("\n",l)+1:l;if(t>-1&&i>0){const[o,r,c]=u(a,t,i),d=o[e?"pop":"shift"](),p=(d.length+1)*(e?1:-1);o[e?"unshift":"push"](d),m(n,o.join("\n"),r,c,s+p,l+p)}}else{const[t,i,o]=u(a,s,l),r=t.join("\n"),c=e?r.length+1:0;m(n,r+"\n"+r,i,o,s+c,l+c)}return b()}};l(n,"keydown",(e=>{const t=x(e),l=e.keyCode,[c,d,h]=y();if(t==j&&(221==l||219==l))return S(219==l,...u(n.value,c,d),c,d,...v(a)),b();if(t==(o?10:2)&&77==l)R=!R,i(e);else if(191==l&&t==j||65==l&&9==t){const e=n.value,l=9==t,a=l?c:r(e,c),i=s[f(n,a)]||{},{line:o,block:h}=i.getComments?.(n,a,e)||i.comments||{},[g,x,y]=u(e,c,d),v=g.length-1;if(l){if(h){const[t,s]=h,l=e.slice(c,d),a=e.slice(0,c).search(p(t)+" ?$"),i=RegExp("^ ?"+p(s)).test(e.slice(d));a+1&&i?m(n,l,a,d+ +(" "==e[d])+s.length,a,a+d-c):m(n,`${t} ${l} ${s}`,c,d,c+t.length+1,d+t.length+1),b()}}else if(o){const t=p(o),n=RegExp(`^\\s*(${t} ?|$)`),s=RegExp(t+" ?"),l=!/\S/.test(e.slice(x,y)),a=g.map(g.every((e=>n.test(e)))&&!l?e=>e.replace(s,""):e=>l||/\S/.test(e)?e.replace(/^\s*/,`$&${o} `):e);$(g,a,x,y,c,d),b()}else if(h){const[e,t]=h,s=I(g[0]),l=g[0].startsWith(e,s)&&g[v].endsWith(t),a=g.slice();a[0]=g[0].replace(l?RegExp(p(e)+" ?"):/(?=\S)|$/,l?"":e+" ");let i=a[0].length-g[0].length;a[v]=l?a[v].replace(RegExp(`( ?${p(t)})?$`),""):a[v]+" "+t;let o=a.join("\n"),r=s+x,u=r>c?c:Math.max(c+i,r),f=r>d-(c!=d)?d:Math.min(Math.max(r,d+i),x+o.length);m(n,o,x,y,u,Math.max(u,f)),b()}}else if(t==8+j&&75==l){const e=n.value,[t,s,l]=u(e,c,d),a="forward"==h?d-l+t.pop().length:c-s,i=u(e,l+1)[0][0].length;return m(n,"",s-!!s,l+!s,s+Math.min(a,i)),b()}})),["copy","cut","paste"].forEach((e=>l(n,e,(t=>{const[s,l]=y();if(s==l&&T){const[[a],o,r]=u(n.value,s,l);"paste"==e?t.clipboardData.getData("text/plain")==c&&(m(n,c+"\n",o,o,s+c.length+1),b(),i(t)):(T.writeText(c=a),"cut"==e&&(m(n,"",o,r+1),b()),i(t))}}))))},B=a('<div style="color:#0000;display:none;contain:strict;padding:0 var(--_pse) 0 var(--padding-left)" aria-hidden=true>'),O=a("<span> "),P=(e,t,n=/[_\p{N}\p{L}]{2}/u)=>!!t&&n.test(e.slice(t-(e.codePointAt(t-2)>65535?2:1),t+(e.codePointAt(t)>65535?2:1))),A=(e,t=1,n=200)=>{const s=l=>{const a=s.api=(e=>{const t=[new Text],n=[],s=B(),l=[],a=()=>{l[0]&&(l.length=0,s.style.display="none")};let i,o=0;return e.overlays.append(s),{search(r,c,d,h,u,g,f){if(!r)return a();h||(r=p(r));const m=e.value,x=u?m.slice(...u):m,y=u?u[0]:0;let v,b,k,C=0;try{for(i=RegExp(r,"gum"+(c?"":"i"));v=i.exec(x);)b=v[0].length,k=v.index+y,b||(i.lastIndex+=m.codePointAt(k)>65535?2:1),d&&(P(m,k,f)||P(m,k+b,f))||g&&!g(k,k+b)||(l[C++]=[k,k+b])}catch(e){return a(),e.message}if(C){l.length=C,b=Math.min(2*C,2e4);for(let e=t.length;e<=b;)t[e++]=O(),t[e++]=new Text;for(let e=o-1;e>b;)t[e--].remove();o<=b&&s.append(...t.slice(o,b+1));for(let e=0,s=0;e<b;++e){const[a,i]=l[e/2],o=m.slice(s,a),r=m.slice(a,s=i);o!=n[e]&&(t[e].data=n[e]=o),r!=n[++e]&&(t[e].firstChild.data=n[e]=r)}t[b].data=n[b]=m.slice(l[b/2-1][1]),s.style.display="",o=b+1}else a()},container:s,get regex(){return i},matches:l,stopSearch:a}})(l),i=a.container;i.style.zIndex=-1,i.className="selection-matches",l.addListener("selectionChange",(([s,i],o)=>{o=l.focused?o.slice(s,i):"",s+=o.search(/\S/);let r=(o=o.trim()).length;a.search(t>r||r>n?"":o,e,!1,!1,void 0,((e,t)=>e>s||t<=s))}))};return s},K=(e=((e=999)=>{let t,n,s,a,r,c,p,h=0,u=!1;const g=[],f=n=>{n>=e&&(n--,g.shift()),g.splice(h=n,e,[t.value,p(),p()])},m=e=>{g[e]&&(c.value=g[e][0],c.setSelectionRange(...g[e][e<h?2:1]),t.update(),t.extensions.cursor?.scrollIntoView(),h=e,n=!1)},y=(e,v)=>{e.extensions.history=y,t=e,p=e.getSelection,c||f(0),c=e.textarea,e.addListener("selectionChange",(()=>{n=u,u=!1})),l(e,"beforeinput",(e=>{let t=e.data,l=e.inputType;/history/.test(l)?(m(h+("U"==l[7]?-1:1)),i(e)):(r=n&&s==l&&e.isTrusted&&!t?.includes("\n")&&(" "!=t||a==t))||(g[h][2]=d||p()),u=!0,a=t,s=l})),l(e,"input",(()=>f(h+!r))),l(e,"keydown",(e=>{if(!v.readOnly){const t=x(e),n=e.keyCode,s=t==j+8&&90==n||!o&&t==j&&89==n;t==j&&90==n?(m(h-1),i(e)):s&&(m(h+1),i(e))}}))};return y.clear=()=>{f(0),n=!1},y.has=e=>h+e in g,y.go=e=>m(h+e),y})())=>[N(),L(),C(),e=>{let t,n,s,a=-1,i=[],o=()=>{n||(n=e.extensions.matchBrackets);let[l,o]=e.getSelection(),d=l==o&&e.focused&&n&&r(o)||-1;if(d!=a){if(c(),d+1){let n=t[s[d]],l=t[d];i=[n,l].map((t=>g(e,".punctuation",0,-1,t[1]))),i[0]!=i[1]&&n[1]+n[3].length==l[1]&&(i[0].textContent+=i[1].textContent,i[1].textContent="",i[1]=i[0]),c(!0)}else i=[];a=d}},r=e=>{({brackets:t,pairs:s}=n);for(let n,l=0;n=t[++l];)if(!n[4]&&n[5]>=e&&t[s[l]]?.[1]<=e)return l},c=e=>i.forEach((t=>t.classList.toggle("active-bracket",!!e)));l(e,"focus",o),l(e,"blur",o),e.addListener("selectionChange",o),e.addListener("update",(()=>{c(),a=-1}))},M(),A(),e,{update(t){t.value!=t.textarea.value&&e.clear()}}];export{K as common};
